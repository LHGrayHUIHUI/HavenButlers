# å¢å¼ºæ–‡ä»¶ä¸Šä¼ APIä½¿ç”¨æŒ‡å—

## ğŸ“‹ æ¦‚è¿°

æœ¬æ–‡æ¡£ä»‹ç»äº†HavenButlerå­˜å‚¨æœåŠ¡çš„å¢å¼ºæ–‡ä»¶ä¸Šä¼ APIï¼Œæ”¯æŒå®Œæ•´çš„æƒé™è®¾ç½®ã€å…ƒæ•°æ®é…ç½®å’Œå¼‚æ­¥å¤„ç†åŠŸèƒ½ã€‚

## ğŸš€ æ ¸å¿ƒç‰¹æ€§

- **å®Œæ•´æƒé™æ§åˆ¶**ï¼šæ”¯æŒPRIVATEã€FAMILYã€PUBLICä¸‰ç§æƒé™çº§åˆ«
- **æ™ºèƒ½å…ƒæ•°æ®**ï¼šè‡ªåŠ¨æ–‡ä»¶ç±»å‹æ£€æµ‹ã€æ ‡ç­¾ç®¡ç†
- **å¼‚æ­¥å¤„ç†**ï¼šç¼©ç•¥å›¾ç”Ÿæˆã€OCRè¯†åˆ«ã€å‘é‡æ ‡ç­¾
- **å¤šé‡éªŒè¯**ï¼šæ–‡ä»¶ç±»å‹ã€å¤§å°ã€è·¯å¾„å®‰å…¨éªŒè¯
- **é“¾è·¯è¿½è¸ª**ï¼šå®Œæ•´çš„è¯·æ±‚æ—¥å¿—å’Œé”™è¯¯è¿½è¸ª

## ğŸ“š APIæ¥å£

### åŸºç¡€ä¿¡æ¯

- **æ¥å£åœ°å€**ï¼š`POST /api/v1/storage/files/upload`
- **è¯·æ±‚ç±»å‹**ï¼š`multipart/form-data`
- **è®¤è¯æ–¹å¼**ï¼šJWT Token
- **å“åº”æ ¼å¼**ï¼šJSON

### è¯·æ±‚å‚æ•°

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ | ç¤ºä¾‹ |
|--------|------|------|------|------|
| familyId | String | æ˜¯ | å®¶åº­IDï¼ˆæ•°æ®éš”ç¦»ï¼‰ | `family_123` |
| folderPath | String | å¦ | æ–‡ä»¶å¤¹è·¯å¾„ï¼Œé»˜è®¤"/" | `/photos/2024/` |
| file | MultipartFile | æ˜¯ | ä¸Šä¼ çš„æ–‡ä»¶ | - |
| uploaderUserId | String | æ˜¯ | ä¸Šä¼ ç”¨æˆ·ID | `user_456` |
| accessLevel | AccessLevel | æ˜¯ | æƒé™çº§åˆ« | `FAMILY` |
| description | String | å¦ | æ–‡ä»¶æè¿° | `å®¶åº­èšä¼šç…§ç‰‡` |
| tags | List<String> | å¦ | æ–‡ä»¶æ ‡ç­¾ | `["å®¶åº­", "èšä¼š"]` |
| ownerId | String | å¦ | æ–‡ä»¶æ‰€æœ‰è€…IDï¼ˆé»˜è®¤ä½¿ç”¨ä¸Šä¼ è€…ï¼‰ | `user_456` |
| generateThumbnail | Boolean | å¦ | æ˜¯å¦ç”Ÿæˆç¼©ç•¥å›¾ | `true` |
| enableOCR | Boolean | å¦ | æ˜¯å¦å¯ç”¨OCRè¯†åˆ« | `false` |

### æƒé™çº§åˆ«è¯´æ˜

| çº§åˆ« | è¯´æ˜ | è®¿é—®æƒé™ |
|------|------|----------|
| PRIVATE | ç§æœ‰æ–‡ä»¶ | ä»…æ–‡ä»¶æ‰€æœ‰è€…å¯è®¿é—® |
| FAMILY | å®¶åº­æ–‡ä»¶ | å®¶åº­æˆå‘˜å¯è®¿é—® |
| PUBLIC | å…¬å…±æ–‡ä»¶ | æ‰€æœ‰ç™»å½•ç”¨æˆ·å¯è®¿é—® |

## ğŸ“ ä½¿ç”¨ç¤ºä¾‹

### 1. åŸºç¡€ä¸Šä¼ ï¼ˆå®¶åº­ç…§ç‰‡ï¼‰

```bash
curl -X POST "http://localhost:8081/api/v1/storage/files/upload" \
  -H "Authorization: Bearer YOUR_JWT_TOKEN" \
  -F "familyId=family_123" \
  -F "folderPath=/photos/2024/" \
  -F "file=@/path/to/photo.jpg" \
  -F "uploaderUserId=user_456" \
  -F "accessLevel=FAMILY" \
  -F "description=æ˜¥èŠ‚å®¶åº­èšä¼š" \
  -F "tags=[\"å®¶åº­\", \"èšä¼š\", \"æ˜¥èŠ‚\"]"
```

### 2. ç§æœ‰æ–‡æ¡£ä¸Šä¼ ï¼ˆå¯ç”¨OCRï¼‰

```bash
curl -X POST "http://localhost:8081/api/v1/storage/files/upload" \
  -H "Authorization: Bearer YOUR_JWT_TOKEN" \
  -F "familyId=family_123" \
  -F "folderPath=/documents/contracts/" \
  -F "file=@/path/to/contract.pdf" \
  -F "uploaderUserId=user_456" \
  -F "accessLevel=PRIVATE" \
  -F "description=ç§Ÿæˆ¿åˆåŒ" \
  -F "tags=[\"åˆåŒ\", \"ç§Ÿæˆ¿\"]" \
  -F "enableOCR=true"
```

### 3. å…¬å…±èµ„æºä¸Šä¼ ï¼ˆç”Ÿæˆç¼©ç•¥å›¾ï¼‰

```bash
curl -X POST "http://localhost:8081/api/v1/storage/files/upload" \
  -H "Authorization: Bearer YOUR_JWT_TOKEN" \
  -F "familyId=family_123" \
  -F "folderPath=/resources/templates/" \
  -F "file=@/path/to/template.png" \
  -F "uploaderUserId=user_456" \
  -F "accessLevel=PUBLIC" \
  -F "description=è®¾è®¡æ¨¡æ¿" \
  -F "tags=[\"æ¨¡æ¿\", \"è®¾è®¡\"]" \
  -F "generateThumbnail=true"
```

## ğŸ“Š å“åº”ç»“æœ

### æˆåŠŸå“åº”ç¤ºä¾‹

```json
{
  "code": 200,
  "message": "æ–‡ä»¶ä¸Šä¼ æˆåŠŸ",
  "data": {
    "success": true,
    "fileId": "file_abc123def456",
    "familyId": "family_123",
    "fileName": "æ˜¥èŠ‚å®¶åº­èšä¼š_1704110400000.jpg",
    "originalName": "IMG_20240101_120000.jpg",
    "fileSize": 2048576,
    "fileType": "image",
    "accessLevel": "FAMILY",
    "ownerId": "user_456",
    "uploaderUserId": "user_456",
    "storagePath": "family/family_123/images/2024/01/01/file_abc123def456",
    "folderPath": "/photos/2024/",
    "tags": ["å®¶åº­", "èšä¼š", "æ˜¥èŠ‚"],
    "description": "æ˜¥èŠ‚å®¶åº­èšä¼š",
    "uploadTime": "2024-01-01T12:00:00",
    "lastAccessTime": "2024-01-01T12:00:00",
    "accessCount": 0,
    "storageType": "minio",
    "thumbnailPath": "thumbnail/family_123/small/file_abc123def456",
    "hasThumbnail": true,
    "accessUrl": "http://minio:9000/bucket/file_abc123def456?expires=3600",
    "traceId": "tr-20240101-120000-123456"
  },
  "timestamp": "2024-01-01T12:00:00.000Z"
}
```

### é”™è¯¯å“åº”ç¤ºä¾‹

```json
{
  "code": 40001,
  "message": "æ–‡ä»¶ä¸Šä¼ å¤±è´¥: æ–‡ä»¶å¤§å°ä¸èƒ½è¶…è¿‡100MB",
  "data": null,
  "timestamp": "2024-01-01T12:00:00.000Z"
}
```

## ğŸ”§ é«˜çº§åŠŸèƒ½

### 1. æ–‡ä»¶ç±»å‹æ£€æµ‹

ç³»ç»Ÿè‡ªåŠ¨æ£€æµ‹æ–‡ä»¶ç±»å‹å¹¶åˆ†ç±»ï¼š

| ç±»å‹ | æ”¯æŒæ ¼å¼ | åç»­å¤„ç† |
|------|----------|----------|
| å›¾ç‰‡ | jpg, png, gif, webpç­‰ | ç¼©ç•¥å›¾ç”Ÿæˆ |
| æ–‡æ¡£ | pdf, doc, txtç­‰ | OCRè¯†åˆ« |
| è§†é¢‘ | mp4, avi, movç­‰ | è§†é¢‘æˆªå›¾ |
| éŸ³é¢‘ | mp3, wav, flacç­‰ | éŸ³é¢‘åˆ†æ |
| å‹ç¼©åŒ… | zip, rar, 7zç­‰ | è§£å‹ç¼©éªŒè¯ |

### 2. å¼‚æ­¥å¤„ç†ä»»åŠ¡

ä¸Šä¼ å®Œæˆåè‡ªåŠ¨è§¦å‘ä»¥ä¸‹ä»»åŠ¡ï¼š

- **ç¼©ç•¥å›¾ç”Ÿæˆ**ï¼šå›¾ç‰‡æ–‡ä»¶è‡ªåŠ¨ç”Ÿæˆå¤šå°ºå¯¸ç¼©ç•¥å›¾
- **OCRè¯†åˆ«**ï¼šæ–‡æ¡£æ–‡ä»¶è‡ªåŠ¨æå–æ–‡å­—å†…å®¹
- **å‘é‡æ ‡ç­¾**ï¼šåŸºäºæ–‡ä»¶å†…å®¹ç”Ÿæˆæ™ºèƒ½æ ‡ç­¾
- **å­˜å‚¨ä¼˜åŒ–**ï¼šè‡ªåŠ¨é€‰æ‹©æœ€ä½³å­˜å‚¨è·¯å¾„

### 3. æƒé™éªŒè¯æµç¨‹

```
1. éªŒè¯ç”¨æˆ·ç™»å½•çŠ¶æ€
2. æ£€æŸ¥ç”¨æˆ·å®¶åº­æƒé™
3. éªŒè¯ç›®æ ‡è·¯å¾„è®¿é—®æƒé™
4. è®¾ç½®æ–‡ä»¶æƒé™çº§åˆ«
5. è®°å½•æƒé™å˜æ›´å®¡è®¡
```

## ğŸ›¡ï¸ å®‰å…¨é™åˆ¶

### æ–‡ä»¶å¤§å°é™åˆ¶
- **å•ä¸ªæ–‡ä»¶**ï¼šæœ€å¤§100MB
- **æ‰¹é‡ä¸Šä¼ **ï¼šæ¯æ¬¡æœ€å¤š10ä¸ªæ–‡ä»¶
- **å®¶åº­å­˜å‚¨**ï¼šæ€»å®¹é‡10GB

### æ–‡ä»¶ç±»å‹é™åˆ¶
- **ç¦æ­¢ç±»å‹**ï¼šå¯æ‰§è¡Œæ–‡ä»¶ã€è„šæœ¬æ–‡ä»¶
- **å±é™©æ–‡ä»¶**ï¼š.exe, .bat, .sh, .ps1ç­‰
- **è·¯å¾„éå†**ï¼šç¦æ­¢"../"ç­‰è·¯å¾„è·³è½¬

### é¢‘ç‡é™åˆ¶
- **ä¸Šä¼ é¢‘ç‡**ï¼šæ¯åˆ†é’Ÿæœ€å¤š50æ¬¡è¯·æ±‚
- **ç”¨æˆ·é™åˆ¶**ï¼šæ¯å°æ—¶æœ€å¤š500MBä¸Šä¼ é‡
- **å®¶åº­é™åˆ¶**ï¼šæ¯å°æ—¶æœ€å¤š1GBä¸Šä¼ é‡

## ğŸ“ æœ€ä½³å®è·µ

### 1. æƒé™è®¾ç½®å»ºè®®

```bash
# å®¶åº­ç…§ç‰‡ - ä½¿ç”¨FAMILYçº§åˆ«
accessLevel=FAMILY

# ä¸ªäººæ–‡æ¡£ - ä½¿ç”¨PRIVATEçº§åˆ«
accessLevel=PRIVATE

# å…¬å…±èµ„æº - ä½¿ç”¨PUBLICçº§åˆ«
accessLevel=PUBLIC
```

### 2. æ–‡ä»¶å¤¹ç»„ç»‡

```bash
# æ¨èçš„æ–‡ä»¶å¤¹ç»“æ„
/photos/2024/01/     # æŒ‰å¹´æœˆç»„ç»‡ç…§ç‰‡
/documents/contracts/ # åˆåŒæ–‡æ¡£
/resources/templates/  # å…¬å…±æ¨¡æ¿
/videos/family/        # å®¶åº­è§†é¢‘
/music/personal/       # ä¸ªäººéŸ³ä¹
```

### 3. æ ‡ç­¾ç®¡ç†

```bash
# å»ºè®®çš„æ ‡ç­¾è§„èŒƒ
["å®¶åº­", "èšä¼š", "æ˜¥èŠ‚"]           # åœºæ™¯æ ‡ç­¾
["åˆåŒ", "ç§Ÿæˆ¿", "é‡è¦"]           # é‡è¦æ€§æ ‡ç­¾
["æ¨¡æ¿", "è®¾è®¡", "PPT"]            # ç±»å‹æ ‡ç­¾
["å·¥ä½œ", "é¡¹ç›®", "2024Q1"]        # é¡¹ç›®æ ‡ç­¾
```

## ğŸ” æ•…éšœæ’æŸ¥

### å¸¸è§é”™è¯¯åŠè§£å†³æ–¹æ¡ˆ

| é”™è¯¯ç  | é”™è¯¯ä¿¡æ¯ | è§£å†³æ–¹æ¡ˆ |
|--------|----------|----------|
| 40001 | æ–‡ä»¶å¤§å°ä¸èƒ½è¶…è¿‡100MB | å‹ç¼©æ–‡ä»¶æˆ–åˆ†ç‰‡ä¸Šä¼  |
| 40002 | ä¸æ”¯æŒçš„æ–‡ä»¶ç±»å‹ | è½¬æ¢ä¸ºæ”¯æŒçš„æ ¼å¼ |
| 40003 | å®¶åº­IDä¸èƒ½ä¸ºç©º | æ£€æŸ¥ç”¨æˆ·ç™»å½•çŠ¶æ€ |
| 40004 | æ–‡ä»¶å¤¹è·¯å¾„æ ¼å¼ä¸æ­£ç¡® | ä½¿ç”¨"/"å¼€å¤´çš„è·¯å¾„ |
| 50001 | å­˜å‚¨æœåŠ¡å¼‚å¸¸ | æ£€æŸ¥å­˜å‚¨é…ç½®çŠ¶æ€ |

### æ—¥å¿—æŸ¥è¯¢

```bash
# æŸ¥çœ‹ä¸Šä¼ æ—¥å¿—
grep "å¢å¼ºæ–‡ä»¶ä¸Šä¼ " /var/log/storage-service/app.log

# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
grep "ERROR" /var/log/storage-service/app.log

# æŸ¥çœ‹TraceIDæ—¥å¿—
grep "tr-20240101-120000-123456" /var/log/storage-service/app.log
```

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚é‡åˆ°é—®é¢˜ï¼Œè¯·è”ç³»æŠ€æœ¯æ”¯æŒå›¢é˜Ÿï¼š

- **GitHub Issues**ï¼š[é¡¹ç›®åœ°å€](https://github.com/HavenButler/storage-service)
- **æŠ€æœ¯æ–‡æ¡£**ï¼š[APIæ–‡æ¡£](https://docs.havenbutler.com/storage)
- **å®¢æœé‚®ç®±**ï¼šsupport@havenbutler.com

---

*æœ€åæ›´æ–°ï¼š2024å¹´1æœˆ1æ—¥*