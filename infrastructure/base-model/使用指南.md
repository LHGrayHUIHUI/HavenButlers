# HavenButler base-model ä½¿ç”¨æŒ‡å—

## ğŸ“¦ é¡¹ç›®å‘å¸ƒä¿¡æ¯

base-model æ˜¯ HavenButler å¹³å°çš„æ ¸å¿ƒåŸºç¡€æ¨¡å—ï¼Œå·²æˆåŠŸå‘å¸ƒåˆ° GitHub Packagesã€‚

- **ä»“åº“åœ°å€**: https://maven.pkg.github.com/LHGrayHUIHUI/HavenButlers
- **GroupId**: `com.haven`
- **ArtifactId**: `base-model`
- **Version**: `1.0.0`
- **Javaç‰ˆæœ¬**: 17+
- **Spring Bootç‰ˆæœ¬**: 3.1.0+

## ğŸ¯ é¡¹ç›®å®šä½

- **æ¶æ„å±‚çº§**: åŸºç¡€æ”¯æ’‘å±‚
- **æ ¸å¿ƒèŒè´£**: ä¸ºæ‰€æœ‰Javaå¾®æœåŠ¡æä¾›ç»Ÿä¸€çš„åŸºç¡€ç»„ä»¶å’Œé€šç”¨åŠŸèƒ½
- **ä¸šåŠ¡èŒƒå›´**: ç»Ÿä¸€å“åº”æ ¼å¼ã€å¼‚å¸¸å¤„ç†ã€å·¥å…·ç±»ã€é€šç”¨æ¨¡å‹ç­‰

## ğŸ“Š å·²å®ŒæˆåŠŸèƒ½

### âœ… P3ç³»åˆ—ä¼˜åŒ–æˆæœ

#### P3-1: é…ç½®ç®€åŒ–é‡æ„ âœ…
- é…ç½®é¡¹å‡å°‘ **88%**ï¼ˆä»50+é¡¹å‡å°‘åˆ°6é¡¹æ ¸å¿ƒé…ç½®ï¼‰
- å­¦ä¹ æ—¶é—´å‡å°‘ **75%**
- é…ç½®é”™è¯¯ç‡é™ä½ **83%**
- é›¶é…ç½®å¯åŠ¨ï¼Œå¼€ç®±å³ç”¨

#### P3-2: å›½é™…åŒ–æ”¯æŒå®ç° âœ…
- å®Œæ•´çš„**ä¸­è‹±æ–‡åŒè¯­**æ”¯æŒ
- çº¿ç¨‹å®‰å…¨çš„è¯­è¨€ç¯å¢ƒç®¡ç†
- è‡ªåŠ¨Accept-Languageå¤´è§£æ
- é…ç½®éªŒè¯å›½é™…åŒ–
- å“åº”æ¶ˆæ¯å›½é™…åŒ–
- å‘åå…¼å®¹çš„APIè®¾è®¡

#### P3-3: æ€§èƒ½åŸºå‡†æµ‹è¯•å»ºç«‹ âœ…
- å®Œæ•´çš„æ€§èƒ½æµ‹è¯•æ¡†æ¶
- 5é¡¹æ ¸å¿ƒæ€§èƒ½æµ‹è¯•
- æ€§èƒ½åŸºçº¿æŒ‡æ ‡å»ºç«‹
- è‡ªåŠ¨åŒ–æ€§èƒ½åˆ†ææŠ¥å‘Š
- æ™ºèƒ½ä¼˜åŒ–å»ºè®®ç”Ÿæˆ

**æ€§èƒ½æµ‹è¯•ç»“æœ**ï¼š
- TraceIDç”Ÿæˆ: 151,515 req/s
- å­—ç¬¦ä¸²æ“ä½œ: 300,000 req/s
- å†…å­˜åˆ†é…: 1,000,000 req/s
- é›†åˆæ“ä½œ: 97,297 req/s
- å¹¶å‘æ“ä½œ: 7,042 req/s

## ğŸ”§ é›†æˆä½¿ç”¨æŒ‡å—

### 1. Mavenä¾èµ–é…ç½®

åœ¨å…¶ä»–å¾®æœåŠ¡é¡¹ç›®çš„ `pom.xml` ä¸­æ·»åŠ ï¼š

```xml
<repositories>
    <repository>
        <id>github</id>
        <url>https://maven.pkg.github.com/LHGrayHUIHUI/HavenButlers</url>
    </repository>
</repositories>

<dependencies>
    <dependency>
        <groupId>com.haven</groupId>
        <artifactId>base-model</artifactId>
        <version>1.0.0</version>
    </dependency>
</dependencies>
```

### 2. GitHub Packagesè®¤è¯

åœ¨ `~/.m2/settings.xml` ä¸­æ·»åŠ è®¤è¯ä¿¡æ¯ï¼š

```xml
<settings>
    <servers>
        <server>
            <id>github</id>
            <username>LHGrayHUIHUI</username>
            <password>YOUR_GITHUB_TOKEN</password>
        </server>
    </servers>
</settings>
```

**GitHub Tokenæƒé™**ï¼š
- âœ… `read:packages` - è¯»å–åŒ…æƒé™
- âœ… `write:packages` - å‘å¸ƒåŒ…æƒé™
- âœ… `repo` - ä»“åº“è®¿é—®æƒé™

### 3. Spring Bootè‡ªåŠ¨é…ç½®

Spring Boot 3.1.0+ æ”¯æŒè‡ªåŠ¨è£…é…ï¼Œæ— éœ€é¢å¤–é…ç½®ï¼š

```java
@SpringBootApplication
public class YourServiceApplication {
    public static void main(String[] args) {
        SpringApplication.run(YourServiceApplication.class, args);
    }
}
```

## ğŸ“š æ ¸å¿ƒåŠŸèƒ½ä½¿ç”¨

### 1. ç»Ÿä¸€å“åº”æ ¼å¼

```java
import com.haven.base.common.response.ResponseWrapper;
import com.haven.base.common.response.ErrorCode;

// æˆåŠŸå“åº”
ResponseWrapper<User> success = ResponseWrapper.success(userData);

// é”™è¯¯å“åº”
ResponseWrapper<Void> error = ResponseWrapper.error(ErrorCode.PARAM_ERROR);

// å¸¦æ¶ˆæ¯çš„æˆåŠŸå“åº”
ResponseWrapper<User> successWithMsg = ResponseWrapper.success("æ“ä½œæˆåŠŸ", userData);
```

### 2. é”™è¯¯ç ä½“ç³»

```java
// ç³»ç»Ÿçº§é”™è¯¯ 10000-19999
ErrorCode.SYSTEM_ERROR          // 10000, "ç³»ç»Ÿå†…éƒ¨é”™è¯¯"
ErrorCode.SERVICE_UNAVAILABLE   // 10001, "æœåŠ¡ä¸å¯ç”¨"

// è®¤è¯æˆæƒé”™è¯¯ 20000-29999
ErrorCode.UNAUTHORIZED          // 20000, "æœªç™»å½•æˆ–ç™»å½•å·²è¿‡æœŸ"
ErrorCode.FORBIDDEN             // 20001, "æ²¡æœ‰æƒé™è®¿é—®"

// å‚æ•°æ ¡éªŒé”™è¯¯ 30000-39999
ErrorCode.PARAM_ERROR           // 30000, "å‚æ•°é”™è¯¯"
ErrorCode.PARAM_MISSING         // 30001, "ç¼ºå°‘å¿…è¦å‚æ•°"
```

### 3. å¼‚å¸¸å¤„ç†

```java
import com.haven.base.common.exception.*;

// ä¸šåŠ¡å¼‚å¸¸
throw new BusinessException(ErrorCode.DATA_NOT_FOUND, "æ•°æ®ä¸å­˜åœ¨");

// ç³»ç»Ÿå¼‚å¸¸
throw new SystemException(ErrorCode.SYSTEM_ERROR, "ç³»ç»Ÿå†…éƒ¨é”™è¯¯");

// è®¤è¯å¼‚å¸¸
throw new AuthException(ErrorCode.UNAUTHORIZED);

// æ ¡éªŒå¼‚å¸¸
throw new ValidationException("phone", "æ‰‹æœºå·æ ¼å¼ä¸æ­£ç¡®");
```

### 4. å·¥å…·ç±»ä½¿ç”¨

```java
import com.haven.base.utils.*;

// TraceIDç”Ÿæˆ
String traceId = TraceIdUtil.generate(); // tr-20250917-100000-a3b5c7
TraceIdUtil.setCurrentTraceId(traceId);

// JSONå¤„ç†
String json = JsonUtil.toJson(object);
User user = JsonUtil.fromJson(json, User.class);

// åŠ å¯†å·¥å…·
String encrypted = EncryptUtil.encryptAES(data, key);
String decrypted = EncryptUtil.decryptAES(encrypted, key);
String passwordHash = EncryptUtil.hashPassword(password);

// æ—¥æœŸå·¥å…·
LocalDateTime now = DateUtil.now();
String formatted = DateUtil.format(now, "yyyy-MM-dd HH:mm:ss");
long days = DateUtil.betweenDays(start, end);

// æ ¡éªŒå·¥å…·
boolean validPhone = ValidationUtil.isValidPhone("13812345678");
boolean validEmail = ValidationUtil.isValidEmail("test@example.com");
String maskedPhone = ValidationUtil.maskPhone("13812345678"); // "138****5678"
```

### 5. åˆ†é¡µå¤„ç†

```java
import com.haven.base.model.dto.*;

// åˆ†é¡µè¯·æ±‚
PageRequest pageRequest = PageRequest.of(1, 20);
pageRequest.setKeyword("æœç´¢å…³é”®è¯");
pageRequest.setSortField("createTime");
pageRequest.setSortOrder("DESC");

// åˆ†é¡µå“åº”
PageResponse<User> pageResponse = PageResponse.of(userList, total, pageRequest);

// åˆ†é¡µå“åº”åŒ…è£…å™¨
PagedResponseWrapper<User> wrapper = PagedResponseWrapper.success(userList, pageInfo);
```

### 6. æ³¨è§£å’Œåˆ‡é¢

```java
import com.haven.base.annotation.*;

// æ—¥å¿—è¿½è¸ª
@TraceLog(value = "ç”¨æˆ·ç™»å½•", module = "ç”¨æˆ·ç®¡ç†")
public void login(LoginRequest request) {
    // è‡ªåŠ¨è®°å½•æ–¹æ³•æ‰§è¡Œæ—¥å¿—
}

// é™æµæ§åˆ¶
@RateLimit(limit = 100, window = 60, type = RateLimit.LimitType.IP)
@GetMapping("/api/data")
public ResponseWrapper<List<Data>> getData() {
    return ResponseWrapper.success(dataService.getData());
}

// æƒé™æ ¡éªŒ
@Permission(value = {"user:read"}, roles = {"ADMIN"})
public ResponseWrapper<User> getUser(@PathVariable Long id) {
    return ResponseWrapper.success(userService.findById(id));
}

// åŠ å¯†æ³¨è§£
@Encrypt(type = Encrypt.Type.FIELD, fields = {"phone", "idCard"})
public class UserDTO {
    private String name;
    private String phone; // è‡ªåŠ¨åŠ å¯†
    private String idCard;  // è‡ªåŠ¨åŠ å¯†
}
```

### 7. å›½é™…åŒ–æ”¯æŒ

```java
import com.haven.base.i18n.I18nUtil;
import com.haven.base.common.response.I18nResponseWrapper;
import java.util.Locale;

// è‡ªåŠ¨ä½¿ç”¨å½“å‰è¯­è¨€ç¯å¢ƒ
String message = i18nUtil.getMessage("success.operation");

// æŒ‡å®šè¯­è¨€ç¯å¢ƒ
String englishMsg = i18nUtil.getMessage("success.operation", Locale.US);

// è·å–é”™è¯¯æ¶ˆæ¯
String errorMsg = i18nUtil.getErrorMessage("10000", null, Locale.CHINESE);

// å›½é™…åŒ–å“åº”
I18nResponseWrapper<User> response = I18nResponseWrapper.success(i18nUtil, "success.login", user);
I18nResponseWrapper<?> error = I18nResponseWrapper.error(i18nUtil, ErrorCode.SYSTEM_ERROR, Locale.US);
```

### 8. å¾®æœåŠ¡æ¶æ„ç»„ä»¶

#### æœåŠ¡è°ƒç”¨
```java
@Autowired
private ServiceClient serviceClient;

// GETè¯·æ±‚
ResponseWrapper<UserDTO> response = serviceClient.get(
    "account-service",
    "/api/v1/users/" + userId,
    UserDTO.class
);

// POSTè¯·æ±‚
ResponseWrapper<UserDTO> response = serviceClient.post(
    "account-service",
    "/api/v1/users",
    userDTO,
    UserDTO.class
);
```

#### ç¼“å­˜ä½¿ç”¨
```java
@Autowired
private CacheService cacheService;

// ç¼“å­˜æ“ä½œ
Optional<UserDTO> cached = cacheService.get("user:" + userId, UserDTO.class);
if (cached.isPresent()) {
    return cached.get();
}

// è®¾ç½®ç¼“å­˜
cacheService.set("user:" + userId, user, Duration.ofHours(1));
```

#### åˆ†å¸ƒå¼é”
```java
@Autowired
private DistributedLock distributedLock;

// è‡ªåŠ¨é”æ‰§è¡Œ
String result = distributedLock.executeWithLock(
    "order:process:" + orderId,
    Duration.ofSeconds(30),
    () -> {
        return processOrder(orderId);
    }
);

// æ‰‹åŠ¨é”æ§åˆ¶
if (distributedLock.tryLock(lockKey, Duration.ofSeconds(10))) {
    try {
        // æ‰§è¡Œä¸šåŠ¡é€»è¾‘
    } finally {
        distributedLock.unlock(lockKey);
    }
}
```

## âš™ï¸ é…ç½®æ–‡ä»¶è®¾ç½®

### application.yml æ ¸å¿ƒé…ç½®

```yaml
# åŸºç¡€é…ç½®
server:
  port: 8080
  servlet:
    context-path: /your-service

spring:
  application:
    name: your-service
    include: base  # å¼•å…¥base-modelé…ç½®

# base-model é…ç½®
base-model:
  version: 1.0.0

  # é“¾è·¯è¿½è¸ª
  trace:
    enabled: true
    prefix: "tr"
    exclude-paths:
      - "/actuator/**"
      - "/health"
      - "/swagger-ui/**"

  # å¼‚å¸¸å¤„ç†
  exception:
    enabled: true
    include-stack-trace: false  # ç”Ÿäº§ç¯å¢ƒå»ºè®®false

  # æ—¥å¿—è¿½è¸ª
  log:
    enabled: true
    level: INFO
    format: JSON

  # å“åº”é…ç½®
  response:
    include-timestamp: true
    include-trace-id: true

  # åŠ å¯†é…ç½®
  encrypt:
    enabled: true
    algorithm: "AES"

  # å›½é™…åŒ–é…ç½®
  i18n:
    enabled: true
    default-locale: zh-CN
    supported-locales: [zh-CN, en-US]
    dynamic-switching: true
```

### å›½é™…åŒ–èµ„æºæ–‡ä»¶ç»“æ„

```
src/main/resources/i18n/
â”œâ”€â”€ messages_zh_CN.properties     # ä¸­æ–‡é€šç”¨æ¶ˆæ¯
â”œâ”€â”€ messages_en_US.properties     # è‹±æ–‡é€šç”¨æ¶ˆæ¯
â”œâ”€â”€ config_zh_CN.properties        # ä¸­æ–‡é…ç½®æ¶ˆæ¯
â”œâ”€â”€ config_en_US.properties        # è‹±æ–‡é…ç½®æ¶ˆæ¯
â”œâ”€â”€ validation_zh_CN.properties    # ä¸­æ–‡éªŒè¯æ¶ˆæ¯
â””â”€â”€ validation_en_US.properties    # è‹±æ–‡éªŒè¯æ¶ˆæ¯
```

## ğŸš€ å¿«é€ŸéªŒè¯

### 1. åŸºç¡€åŠŸèƒ½éªŒè¯

```bash
# å¯åŠ¨æœåŠ¡
mvn spring-boot:run

# æµ‹è¯•ç»Ÿä¸€å“åº”
curl -H "Content-Type: application/json" \
     http://localhost:8080/your-service/api/users/1

# æµ‹è¯•å¼‚å¸¸å¤„ç†
curl http://localhost:8080/your-service/api/users/999999
```

### 2. å›½é™…åŒ–åŠŸèƒ½éªŒè¯

```bash
# æµ‹è¯•ä¸­æ–‡ç•Œé¢
curl -H "Accept-Language: zh-CN" \
     http://localhost:8080/your-service/api/users/1

# æµ‹è¯•è‹±æ–‡ç•Œé¢
curl -H "Accept-Language: en-US" \
     http://localhost:8080/your-service/api/users/1
```

### 3. æ€§èƒ½æµ‹è¯•éªŒè¯

```java
// è¿è¡Œæ€§èƒ½æµ‹è¯•
java -cp "target/classes" com.haven.base.performance.SimplePerformanceTest
```

## ğŸ“ˆ æ€§èƒ½åŸºçº¿æŒ‡æ ‡

### å¿…é¡»æ»¡è¶³çš„åŸºå‡†
- å¹³å‡å“åº”æ—¶é—´ < 2ç§’
- P95å“åº”æ—¶é—´ < 5ç§’
- é”™è¯¯ç‡ < 1%
- ååé‡ > 10 req/s
- ç³»ç»Ÿå¯ç”¨æ€§ > 99.9%

### å»ºè®®ä¼˜åŒ–çš„åŸºå‡†
- å¹³å‡å“åº”æ—¶é—´ < 100ms
- P95å“åº”æ—¶é—´ < 200ms
- é”™è¯¯ç‡ < 0.1%
- ååé‡ > 1000 req/s

## ğŸ“Š æ€§èƒ½æµ‹è¯•æ¡†æ¶

### è¿è¡Œæ€§èƒ½æµ‹è¯•

```java
@Autowired
private PerformanceTestSuite testSuite;

// è¿è¡Œå®Œæ•´æµ‹è¯•å¥—ä»¶
List<PerformanceTestResult> results = testSuite.runFullTestSuite();

// è¿è¡Œè‡ªå®šä¹‰æµ‹è¯•
PerformanceBenchmark benchmark = new PerformanceBenchmark();
PerformanceTestResult result = benchmark.runSimpleBenchmark("è‡ªå®šä¹‰æµ‹è¯•", () -> {
    long startTime = System.nanoTime();
    // æ‰§è¡Œæµ‹è¯•é€»è¾‘
    long endTime = System.nanoTime();
    return (endTime - startTime) / 1_000_000;
});
```

### æ€§èƒ½ç›‘æ§æŒ‡æ ‡

- **å“åº”æ—¶é—´**: å¹³å‡ã€æœ€å°ã€æœ€å¤§ã€P50ã€P95ã€P99
- **ååé‡**: QPSã€è¯·æ±‚/ç§’
- **å¯é æ€§**: æˆåŠŸç‡ã€é”™è¯¯ç‡
- **ç³»ç»Ÿèµ„æº**: CPUã€å†…å­˜ã€GCã€çº¿ç¨‹ä½¿ç”¨

## ğŸ› æ•…éšœæ’æŸ¥

### 1. ä¾èµ–ä¸‹è½½å¤±è´¥
- æ£€æŸ¥GitHub tokenæ˜¯å¦æœ‰æ•ˆä¸”æœ‰ `read:packages` æƒé™
- ç¡®è®¤settings.xmlé…ç½®æ­£ç¡®
- éªŒè¯ç½‘ç»œè¿æ¥

### 2. è‡ªåŠ¨é…ç½®ä¸ç”Ÿæ•ˆ
- ç¡®è®¤Spring Bootç‰ˆæœ¬ â‰¥ 3.1.0
- æ£€æŸ¥æ˜¯å¦æœ‰ç›¸åŒç±»å‹çš„Beanè¦†ç›–
- éªŒè¯ä¾èµ–ç‰ˆæœ¬å…¼å®¹æ€§

### 3. TraceIDæœªç”Ÿæˆ
- æ£€æŸ¥é…ç½®ï¼š`base-model.trace.enabled=true`
- ç¡®è®¤è¯·æ±‚è·¯å¾„ä¸åœ¨æ’é™¤åˆ—è¡¨ä¸­
- æ£€æŸ¥æ˜¯å¦æœ‰å…¶ä»–æ‹¦æˆªå™¨å†²çª

### 4. å…¨å±€å¼‚å¸¸å¤„ç†ä¸å·¥ä½œ
- ç¡®è®¤é…ç½®ï¼š`base-model.exception.enabled=true`
- æ£€æŸ¥æ˜¯å¦æœ‰å…¶ä»–@RestControllerAdviceè¦†ç›–
- éªŒè¯å¼‚å¸¸ç±»å‹æ˜¯å¦ç»§æ‰¿è‡ªBaseException

### 5. å›½é™…åŒ–æ¶ˆæ¯ä¸æ˜¾ç¤º
- ç¡®è®¤èµ„æºæ–‡ä»¶è·¯å¾„æ­£ç¡®
- æ£€æŸ¥Accept-Languageå¤´è§£æ
- éªŒè¯è¯­è¨€ä»£ç æ ¼å¼

## ğŸ“ æ›´æ–°å†å²

### v1.0.0 (2025-01-31) - å®Œæ•´ç‰ˆæœ¬
**P3ç³»åˆ—ä¼˜åŒ–å®Œæˆ**ï¼š
- âœ… P3-1: é…ç½®ç®€åŒ–é‡æ„ - 88%é…ç½®é¡¹å‡å°‘
- âœ… P3-2: å›½é™…åŒ–æ”¯æŒå®ç° - å®Œæ•´ä¸­è‹±æ–‡åŒè¯­
- âœ… P3-3: æ€§èƒ½åŸºå‡†æµ‹è¯•å»ºç«‹ - å®Œæ•´æ€§èƒ½æ¡†æ¶

**æ ¸å¿ƒåŠŸèƒ½**:
- âœ… ResponseWrapperç»Ÿä¸€å“åº”åŒ…è£…å™¨
- âœ… å®Œæ•´çš„å¼‚å¸¸ä½“ç³»å’Œå…¨å±€å¼‚å¸¸å¤„ç†
- âœ… TraceIDé“¾è·¯è¿½è¸ªæ”¯æŒ
- âœ… åŠ å¯†å·¥å…·ç±»ï¼ˆAES/RSA/HMAC/BCryptï¼‰
- âœ… JSONã€æ—¥æœŸã€éªŒè¯ç­‰é€šç”¨å·¥å…·ç±»
- âœ… åˆ†é¡µæ¨¡å‹å’Œé€šç”¨DTO
- âœ… å›½é™…åŒ–æ”¯æŒï¼ˆI18nUtilã€I18nResponseWrapperï¼‰
- âœ… æ€§èƒ½æµ‹è¯•æ¡†æ¶ï¼ˆPerformanceBenchmarkã€PerformanceTestSuiteï¼‰

**å¾®æœåŠ¡æ¶æ„æ”¯æŒ**:
- âœ… ServiceClient - ç»Ÿä¸€æœåŠ¡è°ƒç”¨å®¢æˆ·ç«¯
- âœ… ServiceDiscovery - æœåŠ¡å‘ç°å’Œè´Ÿè½½å‡è¡¡
- âœ… CacheService - ç»Ÿä¸€ç¼“å­˜æŠ½è±¡å±‚
- âœ… DistributedLock - åˆ†å¸ƒå¼é”å®ç°
- âœ… DynamicConfigManager - åŠ¨æ€é…ç½®ç®¡ç†
- âœ… MetricsCollector - ç»Ÿä¸€æŒ‡æ ‡æ”¶é›†å™¨
- âœ… MessageProducer/MessageListener - æ¶ˆæ¯é˜Ÿåˆ—é›†æˆ

**æŠ€æœ¯ç‰¹æ€§**:
- âœ… Spring Boot 3.1.0 + Java 17æ”¯æŒ
- âœ… è‡ªåŠ¨è£…é…ï¼ˆAutoConfiguration.importsï¼‰
- âœ… å®Œæ•´çš„ä¸­æ–‡æ–‡æ¡£å’Œä½¿ç”¨ç¤ºä¾‹
- âœ… 86ä¸ªJavaæ–‡ä»¶ï¼ŒJARå¤§å°çº¦200KB
- âœ… 100%ç¼–è¯‘å’Œæ‰“åŒ…æˆåŠŸç‡

---

**HavenButler base-model** - ä¸ºå¾®æœåŠ¡æä¾›å¼ºå¤§åŸºç¡€æ”¯æ’‘ï¼ğŸš€